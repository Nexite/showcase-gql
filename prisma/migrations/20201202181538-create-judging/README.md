# Migration `20201202181538-create-judging`

This migration has been generated by Tyler Menezes at 12/2/2020, 1:15:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `JudgingPool` (
    `id` VARCHAR(191) NOT NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updatedAt` DATETIME(3) NOT NULL,
    `name` VARCHAR(191) NOT NULL,
    `eventId` VARCHAR(191),
    `programId` VARCHAR(191) DEFAULT 'codeday',
    `eventGroupId` VARCHAR(191),
    `regionId` VARCHAR(191),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `JudgingCriteria` (
    `id` VARCHAR(191) NOT NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updatedAt` DATETIME(3) NOT NULL,
    `judgingPoolId` VARCHAR(191) NOT NULL,
    `name` VARCHAR(191) NOT NULL,
    `weight` DECIMAL(65,30) NOT NULL,

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `Judgement` (
    `id` VARCHAR(191) NOT NULL,
    `createdAt` DATETIME(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
    `updatedAt` DATETIME(3) NOT NULL,
    `judgingPoolId` VARCHAR(191) NOT NULL,
    `judgingCriteriaId` VARCHAR(191) NOT NULL,
    `projectId` VARCHAR(191) NOT NULL,
    `username` VARCHAR(191) NOT NULL,
    `value` DECIMAL(65,30) NOT NULL,
UNIQUE INDEX `Judgement.projectId_judgingCriteriaId_username_unique`(`projectId`,
`judgingCriteriaId`,
`username`),

    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `JudgingCriteria` ADD FOREIGN KEY (`judgingPoolId`) REFERENCES `JudgingPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Judgement` ADD FOREIGN KEY (`judgingPoolId`) REFERENCES `JudgingPool`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Judgement` ADD FOREIGN KEY (`judgingCriteriaId`) REFERENCES `JudgingCriteria`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `Judgement` ADD FOREIGN KEY (`projectId`) REFERENCES `Project`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201201200518-create-metrics..20201202181538-create-judging
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -35,96 +35,145 @@
   ADMIN
 }
 model Project {
-  id                String    @id @default(cuid())
-  createdAt         DateTime  @default(now())
-  updatedAt         DateTime  @updatedAt
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
   name              String
-  featured          Boolean   @default(false)
-  type              ProjectType @default(APP)
+  featured          Boolean         @default(false)
+  type              ProjectType     @default(APP)
   description       String?
   priorExperience   String?
   codeLink          String?
   viewLink          String?
   eventId           String
-  programId         String @default("codeday")
+  programId         String          @default("codeday")
   eventGroupId      String?
   regionId          String?
   media             Media[]
   awards            Award[]
   members           Member[]
   metadata          Metadata[]
+  metrics           Metric[]
+  judgements        Judgement[]
 }
 model Media {
-  id          String      @id @default(cuid())
-  createdAt         DateTime  @default(now())
-  updatedAt         DateTime  @updatedAt
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
-  type        MediaType
-  topic       MediaTopic
+  type              MediaType
+  topic             MediaTopic
-  image       String
-  stream      String?
-  download    String?
+  image             String
+  stream            String?
+  download          String?
-  project     Project     @relation(fields: [projectId], references: [id])
-  projectId   String
+  project           Project         @relation(fields: [projectId], references: [id])
+  projectId         String
 }
 model Award {
-  id          String      @id @default(cuid())
-  createdAt         DateTime  @default(now())
-  updatedAt         DateTime  @updatedAt
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
-  type        String
-  modifier    String?
+  type              String
+  modifier          String?
-  project     Project     @relation(fields: [projectId], references: [id])
-  projectId   String
+  project           Project        @relation(fields: [projectId], references: [id])
+  projectId         String
   @@unique([projectId, type, modifier])
 }
 model Member {
   @@id([projectId, username])
-  createdAt         DateTime  @default(now())
-  updatedAt         DateTime  @updatedAt
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
-  username    String
+  username          String
-  project     Project     @relation(fields: [projectId], references: [id])
-  projectId   String
+  project           Project         @relation(fields: [projectId], references: [id])
+  projectId         String
 }
 model Metadata {
   @@id([projectId, key])
-  createdAt         DateTime  @default(now())
-  updatedAt         DateTime  @updatedAt
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
   key         String
-  visibility  MetadataVisibility @default(PUBLIC)
+  visibility  MetadataVisibility    @default(PUBLIC)
   value       String?
-  project     Project     @relation(fields: [projectId], references: [id])
+  project     Project               @relation(fields: [projectId], references: [id])
   projectId   String
 }
 model Metric {
-  id                String      @id @default(cuid())
-  createdAt         DateTime    @default(now())
-  updatedAt         DateTime    @updatedAt
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
   name        String
   value       Float
-  member      Member            @relation(fields: [projectId, username], references: [projectId, username])
+  member      Member                @relation(fields: [projectId, username], references: [projectId, username])
   username    String
-  project     Project           @relation(fields: [projectId], references: [id])
+  project     Project               @relation(fields: [projectId], references: [id])
   projectId   String
 }
+
+model JudgingPool {
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
+
+  name              String
+
+  eventId           String?
+  programId         String?         @default("codeday")
+  eventGroupId      String?
+  regionId          String?
+
+  judgingCriteria   JudgingCriteria[]
+}
+
+model JudgingCriteria {
+  id                String          @id @default(cuid())
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
+
+  judgingPool       JudgingPool     @relation(fields: [judgingPoolId], references: [id])
+  judgingPoolId     String
+
+  name              String
+  weight            Float
+}
+
+model Judgement {
+  id                String            @id @default(cuid())
+  createdAt         DateTime          @default(now())
+  updatedAt         DateTime          @updatedAt
+
+  judgingPool       JudgingPool       @relation(fields: [judgingPoolId], references: [id])
+  judgingPoolId     String
+
+  judgingCriteria   JudgingCriteria   @relation(fields: [judgingCriteriaId], references: [id])
+  judgingCriteriaId String
+
+  project           Project           @relation(fields: [projectId], references: [id])
+  projectId         String
+
+  username          String
+  value             Float
+
+  @@unique([projectId, judgingCriteriaId, username])
+}
```


